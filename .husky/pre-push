echo "ğŸ” Running checks before push..."

# Get the remote branch name (default to main)
remote_branch=${1:-main}

# Check package version consistency
if git diff --name-only $remote_branch...HEAD | grep -qE "^(package\.json|apps/.*/package\.json|\.syncpackrc\.json)"; then
  echo "ğŸ“¦ Checking package version consistency..."
  npm run syncpack:check || exit 1
fi

echo "ğŸ” Running type checks..."

# Run type-check for backend if any backend files changed
if git diff --name-only $remote_branch...HEAD | grep -q "^apps/api/"; then
  echo "ğŸ“¦ Checking backend types..."
  npm run type-check --workspace=apps/api || exit 1
fi

# Run type-check for frontend if any frontend files changed
if git diff --name-only $remote_branch...HEAD | grep -q "^apps/app/"; then
  echo "ğŸ“¦ Checking frontend types..."
  npm run type-check --workspace=apps/app || exit 1
fi

# Run type-check for landing if any landing files changed
if git diff --name-only $remote_branch...HEAD | grep -q "^apps/web/"; then
  echo "ğŸ“¦ Checking landing types..."
  npm run type-check --workspace=apps/web || exit 1
fi

# Run type-check for portal if any portal files changed
if git diff --name-only $remote_branch...HEAD | grep -q "^apps/portal/"; then
  echo "ğŸ“¦ Checking portal types..."
  npm run type-check --workspace=apps/portal || exit 1
fi

echo "âœ… All type checks passed!"
