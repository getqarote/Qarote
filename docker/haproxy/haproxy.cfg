global
    daemon
    log stdout local0

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    log global
    option tcplog

# RabbitMQ AMQP Load Balancer
frontend rabbitmq_amqp_frontend
    bind *:5672
    default_backend rabbitmq_amqp_backend

backend rabbitmq_amqp_backend
    balance roundrobin
    server rabbitmq-node1 rabbitmq-node1:5672 check
    server rabbitmq-node2 rabbitmq-node2:5672 check
    server rabbitmq-node3 rabbitmq-node3:5672 check

# RabbitMQ Management UI Load Balancer
frontend rabbitmq_management_frontend
    bind *:15672
    mode http
    default_backend rabbitmq_management_backend

backend rabbitmq_management_backend
    mode http
    balance roundrobin
    option httpchk GET /
    http-check expect status 200
    server rabbitmq-node1 rabbitmq-node1:15672 check
    server rabbitmq-node2 rabbitmq-node2:15672 check
    server rabbitmq-node3 rabbitmq-node3:15672 check

# Stats page
frontend stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if TRUE
